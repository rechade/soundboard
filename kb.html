<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>MC Ricky G KB</title>
  <meta name="description" content="MC Ricky G KB">
  <meta name="MC Ricky G" content="KB">
  <link rel="stylesheet" href="css/styles.css?v=1.0">
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>
<body>	
	<canvas id="myCanvas" width="1200" height="720" style="border:1px solid #d3d3d3;" onmousedown="handleMouseDown(event.clientX,event.clientY)">
		Your browser does not support the HTML5 canvas tag.
	</canvas>

	<textarea id="mytextarea">Text to be changed</textarea> 
	<script src="scripts/pads.js"></script>  
	<script src="scripts/scales.js"></script>
	<script>
		var canvas=document.getElementById("myCanvas");
		var ctx=canvas.getContext("2d");		
		var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
		// prevent scrolling
		document.body.addEventListener('touchmove', function(event) {
			event.preventDefault();
		}, false); 

		// handle initial touches
		canvas.addEventListener('touchstart', function(event) {
			for (var i = 0; i < event.touches.length; i++) {
				var touch = event.touches[i];
				event.preventDefault();
				handleTouchStart(touch.pageX,touch.pageY);			
			}
		}, false);

		scales.changeScale(ScaleType.MAJ);
		//alert ("scaleArray: " +scales.scaleArray);
		scales.changeRootNote(RootNote.E+36);
		//alert ("rootNote: " +scales.rootNote);
		scales.allocatePadNotes();
		//alert ("padNotes: " + scales.notes);	
		
		pads.padWidth = Math.floor(canvas.width / pads.NUM_COLS);
		pads.padHeight = Math.floor(canvas.height / pads.NUM_ROWS);	
		//alert ("padPaints: " + pads.padPaints);
		pads.drawPads(ctx);

		function handleTouchStart(touchX,touchY){
			var colNum = Math.floor(touchX / pads.padWidth);
			var rowNum = pads.NUM_ROWS - Math.floor(touchY / pads.padHeight)-1;
			var padNum = colNum + (rowNum * pads.NUM_COLS);
			//alert(padNum);
			//document.getElementById('mytextarea').innerHTML = "M=" + scales.notes[padNum];		
			playNote(padNum);
		};
		function handleMouseDown(x,y){				
				var colNum = Math.floor(x / pads.padWidth);
				var rowNum = pads.NUM_ROWS - Math.floor(y / pads.padHeight)-1;
				var padNum = colNum + (rowNum * pads.NUM_COLS);
				//alert(padNum);
				//document.getElementById('mytextarea').innerHTML = "M=" + scales.notes[padNum];		
				playNote(padNum);
		};			
		function playNote(padNum){
			// var MIDINote = scales.notes[padNum];
			var pow = (scales.notes[padNum] - 69) / 12.0;			
			var frequency = 440 * Math.pow(2, pow);						
			//alert(frequency);
			beep(frequency);
		};
		function beep(freq) {
			var oscillator = audioCtx.createOscillator();
			var gainNode = audioCtx.createGain();

			oscillator.connect(gainNode);
			gainNode.connect(audioCtx.destination);
			gainNode.gain.value = 0.9;
			oscillator.frequency.value = freq;
			oscillator.type = 'sine';
			oscillator.start();		
			setTimeout(      
				function(){
					oscillator.stop();
				}, 500
			);  
		}
  </script>
</body>
</html>